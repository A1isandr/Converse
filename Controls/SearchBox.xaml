<UserControl x:Class="YetAnotherMessenger.Controls.SearchBox"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:YetAnotherMessenger.Controls"
             xmlns:misc="clr-namespace:YetAnotherMessenger.Misc"
             xmlns:svgc="http://sharpvectors.codeplex.com/svgc/"
             mc:Ignorable="d" 
             d:DesignHeight="40" d:DesignWidth="200">

    <UserControl.Resources>
        <misc:RectConverter x:Key="RectConverter"/>
    </UserControl.Resources>

    <TextBox>
        <TextBox.Style>
            <Style
                TargetType="TextBox">

                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate
                            TargetType="TextBox">

                            <Border x:Name="SearchBoxBorder"
                                    MinHeight="35"
                                    BorderBrush="{StaticResource SearchBoxBorderBrush}"
                                    SnapsToDevicePixels="True"
                                    CornerRadius="10"
                                    Background="{StaticResource SearchBoxBackgroundBrush}">

                                <Grid
                                    UseLayoutRounding="True">

                                    <TextBox x:Name="SearchTextBox"
                                        Text="{TemplateBinding Text}"
                                        Foreground="{StaticResource SearchBoxForegroundBrush}"
                                        FontFamily="Resources/Fonts/#NotoSans"
                                        FontSize="14"
                                        FontWeight="Medium"
                                        VerticalContentAlignment="Center"
                                        TextOptions.TextRenderingMode="ClearType"
                                        TextOptions.TextFormattingMode="Display"
                                        VerticalAlignment="Stretch"
                                        CaretBrush="{StaticResource SearchBoxCaretBrush}"
                                        Cursor="IBeam"
                                        BorderThickness="0"
                                        Padding="5"
                                        Panel.ZIndex="0"
                                        Background="Transparent"/>

                                    <Label
                                        Content="Search"
                                        Foreground="{StaticResource SearchBoxLabelForegroundBrush}"
                                        FontFamily="Resources/Fonts/#NotoSans"
                                        FontSize="14"
                                        FontWeight="Medium"
                                        TextOptions.TextRenderingMode="ClearType"
                                        TextOptions.TextFormattingMode="Display"
                                        VerticalAlignment="Center"
                                        IsHitTestVisible="False"
                                        Margin="5, 0, 0, 0">

                                        <Label.Style>
                                            <Style TargetType="Label">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding ElementName=SearchTextBox, Path=Text}" Value="">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>

                                                <Setter Property="Visibility" Value="Hidden"/>
                                            </Style>
                                        </Label.Style>
                                    </Label>
                                </Grid>
                            </Border>

                            <ControlTemplate.Triggers>
                                <EventTrigger RoutedEvent="GotFocus">
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <ThicknessAnimation
                                                 Storyboard.TargetName="SearchBoxBorder"
                                                 Storyboard.TargetProperty="BorderThickness"
                                                 To="2"
                                                 Duration="0:0:0.3">

                                                <ThicknessAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut"/>
                                                </ThicknessAnimation.EasingFunction>
                                            </ThicknessAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>

                                <EventTrigger RoutedEvent="LostFocus">
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <ThicknessAnimation
                                                 Storyboard.TargetName="SearchBoxBorder"
                                                 Storyboard.TargetProperty="BorderThickness"
                                                 To="0"
                                                 Duration="0:0:0.3">

                                                <ThicknessAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut"/>
                                                </ThicknessAnimation.EasingFunction>
                                            </ThicknessAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </TextBox.Style>
    </TextBox>
</UserControl>
